# MobilnÃ­ stanice ohM2

MobilnÃ­ stanice, nebo vysÃ­laÄka, pro sÃ­Å¥ Meshtastic. JejÃ­m zÃ¡kladem je modul Heltec V3, kterÃ½ je vybaven kontrolÃ©rem ESP32, LoRa Äipem, nabÃ­jecÃ­m obvodem LiPo ÄlÃ¡nku a oled displejem. Modul umÃ­ komunikovat pÅ™es LoRa, Bluetooth a WiFi.

Elektronika vysÃ­laÄky je v 3D tiÅ¡tÄ›nÃ©m pouzdÅ™e. Jeho zÃ¡kladem je model z [Printables]("https://www.printables.com/model/466818-heltec-v3-mini-case-for-meshtastic"). Pro svoje ÃºÄely jsem na nÄ›m udÄ›lal drobnÃ© Ãºpravy, jinÃ¡ zÃ¡da, snÃ­Å¾enÃ­ pÅ™Ã­liÅ¡ vystupujÃ­cÃ­ho okÃ©nka a zadÄ›lÃ¡nÃ­ vÃ½Å™ezu pro plexi. Autor modelu mÃ¡ bohuÅ¾el nastaveno nesdÃ­let a nemodifikovat, takÅ¾e si Ãºpravy nechÃ¡m pro sebe. NovÃ© dÃ­ly ale k dispozici dÃ¡m.

Na zÃ¡dech na pÅ¯vodnÃ­m modelu mi vadila Å¡patnÃ¡ tisknutelnost, chybÄ›jÃ­cÃ­ zÃ¡mky a absence klipu na uchycenÃ­. NavÃ­c jsem si dost oblÃ­bil zÃ¡vitovÃ© vloÅ¾ky, kterÃ© jsem tam pro snazÅ¡Ã­ montÃ¡Å¾ takÃ© doplnil. VÃ½hodou pÅ¯vodnÃ­ho modelu je jeho lehkost, zvlÃ¡Å¡Å¥ ve spojenÃ­ s plastovÃ½mi Å¡roubky (ty se do mosaznÃ½ch zÃ¡vitovÃ½ch vloÅ¾ek nehodÃ­).

Model se sklÃ¡dÃ¡ ze dvou ÄÃ¡stÃ­. Klipu a samotnÃ©ho krytu. Ty se spojujÃ­ lepenÃ­m - ideÃ¡lnÄ› modelÃ¡Å™skÃ½m vteÅ™inovÃ½m lepidlem.

![moje zÃ¡da k vysÃ­laÄce](img/back_cover.png)

DruhÃ¡ drobnÃ¡ Ãºprava je spojenÃ­ tlaÄÃ­tek tenkÃ½m pÃ¡skem. TlaÄÃ­tka na pÅ¯vodnÃ­m modelu jsou samostatnÃ¡ a proto se dost Å¡patnÄ› krabiÄka sklÃ¡dÃ¡ - tlaÄÃ­tka snadno vypadnout. Takto spojenÃ¡ jsou na tom o dost lÃ©pe.

![spojenÃ¡ tlaÄÃ­ka](img/buttons.png)

TlaÄÃ­tka je vhodnÃ© vytisknout ÄirÃ½m filamentem, tÅ™eba basic PLA. PÅ™es pravÃ© tlaÄÃ­tko pak prosvÃ­tÃ¡ kontrolka. Na svojÃ­ stanici jsem vytvoÅ™il pÅ™Ã­mo nad kontrolkou okÃ©nko. To nedoporuÄuju. Kontrolka je na stanici prakticky k niÄemu, takÅ¾e je to zbyteÄnÃ¡ prÃ¡ce navÃ­c.

VÅ¡echny modely a stlka jsou v adresÃ¡Å™i [model](model).

![ohm2 v doku](../www/img/ohm2_v_doku.jpg)

Pro lepÅ¡Ã­ komfort uÅ¾Ã­vÃ¡nÃ­ jsem si k vysÃ­laÄce dodÄ›lal nabÃ­jecÃ­ dok. VÅ¾dy kdyÅ¾ pÅ™ijdu z vÃ½letu, hodÃ­m vysÃ­laÄku zpÄ›t do doku a na pÅ™Ã­Å¡tÄ› mÃ¡m zase nabito. Celou dobu jsem navÃ­c ve spojenÃ­. V domÄ› sice moc dobrÃ½ signÃ¡l nenÃ­, ale spojenÃ­ mi zajiÅ¡Å¥uje pevnÃ¡ stanice ohM1 na stÅ™eÅ¡e, za cenu jednoho hopu navÃ­c.

![model doku](img/holder.png)

Model doku se takÃ© sklÃ¡dÃ¡ ze dvou ÄÃ¡stÃ­. Jedna je samotnÃ½ stojan, druhÃ¡ je zÃ¡tka, kterou se napÃ¡jecÃ­ USB kabel zatÄ›snÃ­ do stojanu. ZÃ¡tka jde zasunout dobÅ™e, ale zÃ¡roveÅˆ drÅ¾Ã­ na mÃ­stÄ› a tÃ­m drÅ¾Ã­ i kabel. BohuÅ¾el uÅ¾ stenÃ½ kabel, ohnutÃ½ dozadu, nemÅ¯Å¾u sehnat. ~~TakÅ¾e to budu muset pÅ™edÄ›lat, protoÅ¾e bych si chtÄ›l poÅ™Ã­dit jeÅ¡tÄ› alespoÅˆ jeden dok do prÃ¡ce.~~ TakÅ¾e sem to pÅ™edÄ›lal, novÃ© modely uÅ¾ tady jsou.

- [nabÃ­jecÃ­ kabely z Aliexpresu](https://www.aliexpress.com/item/1005008331618829.html?spm=a2g0o.order_list.order_list_main.5.7a861802aBEhtq), kterÃ© pasujÃ­ do novÃ© verze a zatÃ­m se dajÃ­ objednat (neÅ¾ mi to zase nÄ›kdo zniÄÃ­).

KromÄ› zÃ¡kladnÃ­ funkce Meshtastic nodu je zapojenÃ­ doplnÄ›nÃ© o GPS Äip. To je kvÅ¯li moÅ¾nosti reportovat polohu. Na displeji se pak takÃ© ukazuje vzdÃ¡lenost od ostatnÃ­ch nodÅ¯, kterÃ© majÃ­ polohu takÃ© zapnutou.

V pouzdÅ™e je takÃ© docela velkÃ½ LiPo ÄlÃ¡nek 2000mAh, aby, i pÅ™es Å¾ravost Heltecu, vydrÅ¾ela vysÃ­laÄka nÄ›jakÃ½ Äas bez nabÃ­jenÃ­.

## Elektronika

- [Heltec V3 (Aliexpress)](https://www.aliexpress.com/item/1005007383620718.html?spm=a2g0o.order_list.order_list_main.171.3e601802HxDH7p)
- [LiPo ÄlÃ¡nek (Aliexpress)](https://www.aliexpress.com/item/1005007850868686.html?spm=a2g0o.order_list.order_list_main.111.3e601802HxDH7p)

### VolitelnÄ›

- [GPS modul (Aliexpress)](https://www.aliexpress.com/item/32832919409.html?spm=a2g0o.order_list.order_list_main.151.3e601802HxDH7p)
- [VypÃ­naÄ (Aliexpress)](https://www.aliexpress.com/item/10000003088863.html?spm=a2g0o.order_list.order_list_main.136.1b5a1802tNyZ4L)

Modul Heltec V3 je tÅ™eba vybrat sprÃ¡vnou frekvenci 868MHz a takÃ© variantu bez krabiÄky a s antÃ©nou a pigtailem.

# AntÃ©ny

PÅ¯vodnÃ­ antÃ©na dodÃ¡vanÃ¡ s module Heltec V3 je pÄ›knÄ› malÃ¡ a vÃ­cemenÄ› se mi zdÃ¡la pouÅ¾itelnÃ¡. MÄ›l jsem ji jak na prvnÃ­ verzi [ohM1 (pevnÃ¡ stanice na stÅ™eÅ¡e)](../ohm1/README.md), tak na mobilnÃ­ ohM2 (o kterÃ© pÃ­Å¡u tady). Na ohM1 jsem ale pÅ™esto poÅ™Ã­dil lepÅ¡Ã­ antÃ©nu. PodotÃ½kÃ¡m, Å¾e nemÃ¡m Å¾Ã¡dnou moÅ¾nost objektivnÃ­ho srovnÃ¡nÃ­ mÄ›Å™enÃ­m - chtÄ›lo by to tÅ™eba NanoVNA. VychÃ¡zel jsem proto z toho, Å¾e pÅ¯vodnÃ­ krÃ¡tkÃ¡ je prostÄ› jen 1/8Î» a 1/4Î» nebo dokonce 1/2Î» musÃ­ bÃ½t prostÄ› lepÅ¡Ã­. A takÃ© z doporuÄenÃ­ na [www.czmesh.cz](https://www.czmesh.cz).

Pro statickÃ½ node ohM1 jsem zatÃ­m zvolil [dlouhou pevnou antÃ©nu z alÃ­ku](https://www.aliexpress.com/item/1005006833587735.html?spm=a2g0o.order_list.order_list_main.161.4ef218025F7g4x). V objednÃ¡vce pÅ™iÅ¡li zrovna dvÄ›, takÅ¾e jsem to mohl zkusit i na mobilnÃ­ stanici ohM2. A byl to velkÃ½ rozdÃ­l, akorÃ¡t Å¾e antÃ©na je fakt velkÃ¡. Mnohem vÄ›tÅ¡Ã­ neÅ¾ vysÃ­laÄka.

Jako kompromis jsem zkusil [delÅ¡Ã­ prutovou ohebnou antÃ©nu, taky z alÃ­ku](https://www.aliexpress.com/item/1005004607615001.html?spm=a2g0o.order_list.order_list_main.41.4ef218025F7g4x). Ta je mnohem lehÄÃ­ a navÃ­c je ohebnÃ¡. DoporuÄuju.

Ceny tÄ›hto antÃ©n se hroznÄ› mÄ›nÃ­ a mÃ¡lokdy ÄlovÄ›k narazÃ­ nÄ›co fakt rozumnÃ©ho (je to pÅ™ece jen drÃ¡t). Celkem by mÄ› zajÃ­malo, ÄÃ­m se to Å™Ã­dÃ­. Asi jak se vyspÃ­ ÄÃ­nskÃ½ radiotelekomunikaÄnÃ­ ÃºÅ™ad. Ale jak pÃ­Å¡u, stojÃ­ to za to.

Abych nebyl za ÃºplnÃ©ho ignoranta, i kdyÅ¾ o antÃ©nÃ¡ch nic nevÃ­m: PÅ¯vodnÃ­ antÃ©na je hustÃ¡ spirÃ¡la dÃ©lky zhruba 1/8Î». SpirÃ¡la je tak hustÃ¡, Å¾e dÃ©lka drÃ¡tu bude minimÃ¡lnÄ› 1/2Î», moÅ¾nÃ¡ vÃ­c, ale pak netuÅ¡Ã­m proÄ. Tedy compact helical. OstatnÃ­ jsou variace na tohle tÃ©ma, nebo pÅ™Ã­mo prutovky. Ta pevnÃ¡ dlouhÃ¡ lomenÃ¡ je urÄitÄ› 1/2Î», ale dovnitÅ™ nikdo nevidÃ­. Tak pruÅ¾nÃ¡ je z trochou fantazie zkrÃ¡cena 1/2Î», za tu cenu snad i s nÄ›jakÃ½m filtrovÃ½m elementem. A nebo je tak drahÃ¡, aby si evropan myslel, Å¾e je kvalitnÃ­.

Pro pobavenÃ­, pokud nÄ›komu ty braifarty vÃ­Å¡e nestaÄily, bych tady jeÅ¡tÄ› uvedl pÄ›knÃ½ ÄlÃ¡nek a odkaz na [HackADay](https://hackaday.com/2025/02/13/what-the-well-dressed-radio-hacker-is-wearing-this-season/), aneb jak vyrobit kravatu, kterÃ¡ funguje jako antÃ©na na meshtastic. KromÄ› krÃ¡snÃ©ho mÃ³dnÃ­ho doplÅˆku, tam pÄ›knÄ› dokumentuje pouÅ¾itÃ­ NanoVNA pro skuteÄnou kvalifikaci antÃ©n ... No snad pÅ™Ã­Å¡tÄ›.

# Aktualizace FW

MÃ¡me tu konec Äervna, aktuÃ¡lnÃ­ FW Meshtastic 2.6.11. Na vysÃ­laÄce ohM2 mÃ¡m 2.5.15. Je tedy na Äase zkusit update. KdyÅ¾ totiÅ¾ vÅ¡echno funguje, je to nuda.

## 1) ZÃ¡loha nastavenÃ­

PÅ™ipojÃ­m vysÃ­laÄku k PC, nebo nÄ›Äemu co umÃ­ [Meshtastic python CLI](meshtastic.org/docs/software/python/cli). Podle nÃ¡vodu na webu [meshtastic.org v sekci Configuration/Radio Config/Security, ÃºplnÄ› dole](meshtastic.org/docs/configuration/radio/security/#security-keys--backup-and-restore) - kdo by to byl tam hledal - udÄ›lÃ¡m kompletnÃ­ zÃ¡lohu nastavenÃ­ nodu. Tedy nejdÅ¯leÅ¾itÄ›jÅ¡Ã­ jsou opravdu ty security vÄ›ci, jako klÃ­Äe.

```meshtastic --export-config > config_backup.yaml```

Tedy ono je nejdÅ™Ã­v dobrÃ© se k tomu vÅ¯bec skusit pÅ™ipojit.

```meshtastic --info```

V tuto chvÃ­li mÅ¯Å¾u zjitit, napÅ™Ã­klad, Å¾e nemÃ¡m nainstalovanÃ½ meshtastic CLI (to tady popisovat nebudu). Nebo, Å¾e meshtastic CLI nemÅ¯Å¾e zaÅ™Ã­zenÃ­ najÃ­t. Nebo jako jÃ¡, Å¾e mÃ¡m CLI starÅ¡Ã­ a bylo by dobrÃ© ho zaktualizovat.

KdyÅ¾ to nejde najÃ­t, tak CLI vypÃ­Å¡e:

```
$ meshtastic --info
No Serial Meshtastic device detected, attempting TCP connection on localhost.
Error connecting to localhost:[Errno 111] Connection refused
```

StaÄÃ­ pak obvykle zadat sprÃ¡vnÃ½ sÃ©riovÃ½ port:

```
$ meshtastic --serial /dev/ttyUSB0 --info
Connected to radio

Owner: ohMesh02ğŸ“Ÿ (ohM2)

...

*** A newer version v2.6.4 is available! Consider running "pip install --upgrade meshtastic" ***
```

A hlÃ¡Å¡ka na konci vÃ½pisu mi Å™Ã­kÃ¡, Å¾e je novÄ›jÅ¡Ã­ verze meshtastic CLI, a jak jÃ­ zÃ­skat. TakÅ¾e, nejdÅ™Ã­v upgrade CLI.

```
pip install --upgrade meshtastic
```

TeÄ uÅ¾ skuteÄnÄ› nic nebrÃ¡nÃ­ zÃ¡loze nastavenÃ­ nodu.

```
meshtastic --serial /dev/ttyUSB0 --export-config > 20250627_ohm2_backup.yaml
```

## 2) NahrÃ¡nÃ­ novÃ©ho FW

Asi nejsnazÅ¡Ã­ zpÅ¯sob je pomocÃ­ webu [Meshtastic Web Flasher](flasher.meshtastic.org). Je k tomu ale tÅ™eba nÄ›jkÃ½ prohlÃ­Å¾eÄ, kterÃ½ podporuje WEB serial. Tedy Chromium, Chrome nebo Edge.

- vyberu zaÅ™Ã­zenÃ­ Heltec V3
- zvolÃ­m poslednÃ­ Betu
- kliknu na Flash

![Web Flasher](img/web_flasher_select.png)

V nÃ¡sledujÃ­cÃ­m dialogu zvolÃ­m Update. NezaÅ¡krtÃ¡vÃ¡m Full Flash Erase, protoÅ¾e mÃ¡m stÃ¡le nadÄ›ji, Å¾e to projde korektnÄ› a nebudu muset obnovovat nastavenÃ­ nodu.

![Web Flasher update](img/web_flasher_connect.png)

NÃ¡sleduje okno s vÃ½bÄ›rem portu:

![Web Flasher port](img/web_flasher_port.png)

A pak pÃ¡r minut nahrÃ¡vÃ¡nÃ­ a success dialog, tedy v lepÅ¡Ã­m pÅ™Ã­padÄ›.

![Web Flasher success](img/web_flasher_success.png)

Pokud node funguje jak mÃ¡, pamatuje si svoje jmÃ©no a nastavenÃ© kanÃ¡ly, je vÅ¡echno v poÅ™Ã¡dku.

PoznÃ¡mka: Pokud se node nechce z nÄ›jkÃ©ho dÅ¯vodu pÅ™ipojit, je dobrÃ© zkusit ho pÅ™ipojit a odpojit fyzicky, nebo takÃ© vypnout a zapnout tab s web flaherem. Obvykle je totiÅ¾ jiÅ¾ nÄ›kde port pÅ™ipojenÃ½ a druhÃ© pÅ™ipojenÃ­ nenÃ­ moÅ¾nÃ©.

MÄ› se to samozÅ™ejmÄ› nepovedlo, hlavnÄ› proto, Å¾e jsem lovil ty screenshoty a pÅ™eskakoval z jednoho okna do druhÃ©ho. Poznal jsem to hned, protoÅ¾e po mÄ› nod po pÅ™ipojenÃ­ k telefonu chtÄ›l nastavit region. UdÄ›lÃ¡m tedy Full Flash Erase a obnovÃ­m nastavenÃ­ nodu ze zÃ¡lohy.

## 3. ObnovenÃ­ nastavenÃ­ ze zÃ¡lohy

Pokud je tÅ™eba, a to je protoÅ¾e jsem to zvrtal, obnovÃ­m nastavenÃ­ nodu ze zÃ¡lohy, pomocÃ­ pÅ™Ã­kazu python meshtastic CLI.

```
meshtastic --serial /dev/ttyUSB0 --configure 20250627_ohm2_backup.yaml
```

Uf. Hotovo. KanÃ¡ly zase mÃ¡m, jmÃ©no taky, na svoje nody se dovolÃ¡m, takÅ¾e se nezmÄ›nily klÃ­Äe. Region se tedy musel nastavit a zaÅ™Ã­zenÃ­ znovu spÃ¡rovat s telefonem. Jo a krÃ¡tkÃ© jmÃ©no sem taky musel nastavit. No a GPS, a jeÅ¡tÄ› pÃ¡r drobnostÃ­. To je vÅ¡echno tÃ­m Full Erase. Tak jednoduchÃ© to mohlo bÃ½t ... No ale teÄ mÃ¡m alespoÅˆ nÃ¡vod na upgrade FW. Asi je na Äase koneÄnÄ› vyrobit nÃ¡vod na kompletnÃ­ nastavenÃ­ nodu.

# Galerie ze stavby nodu

StejnÃ© fotky jsou souÄÃ¡stÃ­ [html dokumentu](../www/heltec_v3_mobile_build.html) v [adresÃ¡Å™i www](../www). StaÄÃ­ tedy stÃ¡hnout repozitÃ¡Å™, v adresÃ¡Å™i www spustit skript get_depend.py, kterÃ½ stÃ¡hne knihovnu lightbox pouÅ¾itou na galerii, a prohlÃ­Å¾et i s kecama co jsem tam dopsal. Jinak taky .. bez kecÅ¯.

![MateriÃ¡l](../www/img/010_parts_needed.jpg)
![PÅ™Ã­prava vodiÄÅ¯ na pÅ™ipojenÃ­ GPS modulu](../www/img/020_solder_wires_to_heltec_v3.jpg)
![MontÃ¡Å¾ vypÃ­naÄe](../www/img/030_mount_switch.jpg)
![MontÃ¡Å¾ antÃ©ny](../www/img/040_mount_antena_pigtail.jpg)
![UmÃ­stÄ›nÃ­ desky Heltec V3](../www/img/050_insert_heltec_v3.jpg)
![UmÃ­stÄ›nÃ­ antÃ©ny GPS](../www/img/060_insert_gps_antena.jpg)
![RozmÃ­stÄ›nÃ­ vodiÄÅ¯ zespodu desky](../www/img/070_bottom_wire_harness.jpg)
![PodlepenÃ­ GPS modulu kaptonovou pÃ¡skou](../www/img/080_capton_tape.jpg)
![VloÅ¾enÃ­ GPS modulu a zakrÃ¡cenÃ­ vodiÄÅ¯](../www/img/090_insert_gps_trim_wires.jpg)
![PÅ™ipÃ¡jenÃ­ GPS modulu](../www/img/100_solder_wires_to_gps.jpg)
![PÅ™ipojenÃ­ antÃ©ny LoRa](../www/img/110_connect_lora_antena.jpg)
![PÅ™ipojenÃ­ GPS antÃ©ny](../www/img/120_connect_gps_antena.jpg)
![PÅ™Ã­prava pÅ™ednÃ­ho krytu](../www/img/130_prepare_front_cover.jpg)
![VloÅ¾enÃ­ pÅ™ednÃ­ho krytu](../www/img/140_insert_front_cover.jpg)
![PÅ™Ã­prava baterie](../www/img/150_prepare_battery.jpg)
![PÅ™ipÃ¡jenÃ­ baterie](../www/img/160_solder_battery_to_switch.jpg)
![HotovÃ¡ stanice](../www/img/170_meshtastic_build.jpg)
![HotovÃ¡ stanice](../www/img/171_meshtastic_build.jpg)
![HotovÃ¡ stanice](../www/img/172_meshtastic_build.jpg)
![HotovÃ¡ stanice](../www/img/173_meshtastic_build.jpg)
![HotovÃ¡ stanice](../www/img/174_meshtastic_build.jpg)
